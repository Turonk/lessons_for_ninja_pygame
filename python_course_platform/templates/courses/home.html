{% extends 'base.html' %}
{% load static %}

{% block title %}–ì–ª–∞–≤–Ω–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞{% endblock %}

{% block content %}
<div class="row">
    <div class="col-12">
        <div class="jumbotron bg-primary text-white rounded p-4 mb-4">
            <h1 class="display-4">–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å –≤ –∫—É—Ä—Å Python!</h1>
            <p class="lead">
                –ò–∑—É—á–∞–π –ø—Ä–æ–≥—Ä–∞–º–º–∏—Ä–æ–≤–∞–Ω–∏–µ –Ω–∞ Python —á–µ—Ä–µ–∑ –∏–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω—ã–µ –∑–∞–¥–∞–Ω–∏—è –∏ –ø—Ä–∞–∫—Ç–∏—á–µ—Å–∫–∏–µ —É–ø—Ä–∞–∂–Ω–µ–Ω–∏—è.
            </p>
            {% if user.is_student %}
                <p>–¢—ã —É—á–µ–Ω–∏–∫ –∫–ª–∞—Å—Å–∞: <strong>{{ user.student_class.name }}</strong></p>
            {% endif %}
        </div>
    </div>
</div>

{% if user.is_student %}
    <!-- –î–æ—Å—Ç—É–ø–Ω—ã–µ —Ç–µ–º—ã –¥–ª—è —É—á–µ–Ω–∏–∫–∞ -->
    <div class="row">
        <div class="col-12">
            <h2 class="mb-4">üìö –î–æ—Å—Ç—É–ø–Ω—ã–µ —Ç–µ–º—ã</h2>

            {% if available_topics %}
                <div class="row">
                    {% for topic in available_topics %}
                        <div class="col-md-6 col-lg-4 mb-4">
                            <div class="card progress-card h-100">
                                <div class="card-body">
                                    <h5 class="card-title">{{ topic.title }}</h5>
                                    <p class="card-text">{{ topic.description|truncatechars:100 }}</p>

                                    {% if topic.progress_info.total > 0 %}
                                        {% widthratio topic.progress_info.completed topic.progress_info.total 100 as progress_percent %}
                                        <div class="progress mb-3">
                                            <div class="progress-bar" role="progressbar"
                                                 style="width: {{ progress_percent }}%"
                                                 aria-valuenow="{{ progress_percent }}"
                                                 aria-valuemin="0" aria-valuemax="100">
                                                {{ topic.progress_info.completed }}/{{ topic.progress_info.total }}
                                            </div>
                                        </div>
                                    {% endif %}

                                    <a href="{% url 'courses:topic_detail' topic.pk %}" class="btn btn-primary">
                                        –ò–∑—É—á–∏—Ç—å —Ç–µ–º—É
                                    </a>
                                </div>
                            </div>
                        </div>
                    {% endfor %}
                </div>
            {% else %}
                <div class="alert alert-info">
                    <h4>üéì –¢–µ–º—ã –ø–æ–∫–∞ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω—ã</h4>
                    <p>–¢–≤–æ–π –ø—Ä–µ–ø–æ–¥–∞–≤–∞—Ç–µ–ª—å —Å–∫–æ—Ä–æ –æ—Ç–∫—Ä–æ–µ—Ç –¥–æ—Å—Ç—É–ø –∫ –ø–µ—Ä–≤—ã–º —Ç–µ–º–∞–º –∫—É—Ä—Å–∞.</p>
                </div>
            {% endif %}
        </div>
    </div>

    <!-- –ü—Ä–æ–≥—Ä–µ—Å—Å —É—á–µ–Ω–∏–∫–∞ -->
    <div class="row mt-4">
        <div class="col-12">
            <h2 class="mb-4">üìä –¢–≤–æ–π –ø—Ä–æ–≥—Ä–µ—Å—Å</h2>

            {% if student_progress %}
                <div class="card">
                    <div class="card-body">
                        <div class="row">
                            {% for progress in student_progress %}
                                {% if progress.status == 'completed' %}
                                    <div class="col-md-3 mb-3">
                                        <div class="card bg-success text-white">
                                            <div class="card-body text-center">
                                                <h5>{{ progress.task.title }}</h5>
                                                <span class="badge bg-light text-dark">{{ progress.best_score }}%</span>
                                            </div>
                                        </div>
                                    </div>
                                {% endif %}
                            {% endfor %}
                        </div>
                    </div>
                </div>
            {% endif %}
        </div>
    </div>

{% elif user.is_admin %}
    <!-- –ü–∞–Ω–µ–ª—å –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞ -->
    <div class="row">
        <div class="col-12">
            <h2 class="mb-4">‚öôÔ∏è –ü–∞–Ω–µ–ª—å –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞</h2>

            <div class="row">
                <div class="col-md-6 col-lg-3 mb-4">
                    <div class="card">
                        <div class="card-body text-center">
                            <h5>üë• –ö–ª–∞—Å—Å—ã</h5>
                            <p>–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫–ª–∞—Å—Å–∞–º–∏ –∏ —É—á–µ–Ω–∏–∫–∞–º–∏</p>
                            <a href="{% url 'courses:class_list' %}" class="btn btn-primary">–£–ø—Ä–∞–≤–ª—è—Ç—å</a>
                        </div>
                    </div>
                </div>

                <div class="col-md-6 col-lg-3 mb-4">
                    <div class="card">
                        <div class="card-body text-center">
                            <h5>üìö –¢–µ–º—ã</h5>
                            <p>–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ç–µ–º–∞–º–∏ –∫—É—Ä—Å–∞</p>
                            <a href="{% url 'courses:topic_list' %}" class="btn btn-primary">–£–ø—Ä–∞–≤–ª—è—Ç—å</a>
                        </div>
                    </div>
                </div>

                <div class="col-md-6 col-lg-3 mb-4">
                    <div class="card">
                        <div class="card-body text-center">
                            <h5>üìä –ü—Ä–æ–≥—Ä–µ—Å—Å</h5>
                            <p>–ü—Ä–æ—Å–º–æ—Ç—Ä –ø—Ä–æ–≥—Ä–µ—Å—Å–∞ —É—á–µ–Ω–∏–∫–æ–≤</p>
                            <a href="{% url 'courses:progress' %}" class="btn btn-primary">–ü—Ä–æ—Å–º–æ—Ç—Ä–µ—Ç—å</a>
                        </div>
                    </div>
                </div>

                <div class="col-md-6 col-lg-3 mb-4">
                    <div class="card">
                        <div class="card-body text-center">
                            <h5>‚öôÔ∏è –ê–¥–º–∏–Ω–∫–∞</h5>
                            <p>Django admin –ø–∞–Ω–µ–ª—å</p>
                            <a href="/admin/" class="btn btn-secondary" target="_blank">–û—Ç–∫—Ä—ã—Ç—å</a>
                        </div>
                    </div>
                </div>
            </div>

            <div class="row">
                <div class="col-12">
                    <h3>üìà –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞</h3>
                    <div class="row">
                        <div class="col-md-3">
                            <div class="card text-center">
                                <div class="card-body">
                                    <h4>{{ managed_classes|length }}</h4>
                                    <p>–ö–ª–∞—Å—Å–æ–≤</p>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-3">
                            <div class="card text-center">
                                <div class="card-body">
                                    <h4>{{ all_topics|length }}</h4>
                                    <p>–¢–µ–º</p>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-3">
                            <div class="card text-center">
                                <div class="card-body">
                                    <h4>{% for class in managed_classes %}{{ class.students.count }}{% if not forloop.last %} + {% endif %}{% endfor %}</h4>
                                    <p>–£—á–µ–Ω–∏–∫–æ–≤</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
{% endif %}

{% endblock %}
