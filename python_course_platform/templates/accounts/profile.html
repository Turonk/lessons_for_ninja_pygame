{% extends 'base.html' %}

{% block title %}–ü—Ä–æ—Ñ–∏–ª—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è{% endblock %}

{% block content %}
<div class="row">
    <div class="col-md-4">
        <div class="card">
            <div class="card-header">
                <h5>üë§ –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ</h5>
            </div>
            <div class="card-body">
                <h6>{{ user.get_full_name|default:user.username }}</h6>
                <p class="text-muted">{{ user.email }}</p>

                <div class="mb-3">
                    <strong>–†–æ–ª—å:</strong>
                    {% if user.is_admin %}
                        <span class="badge bg-danger">–ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä</span>
                    {% elif user.is_teacher %}
                        <span class="badge bg-warning">–ü—Ä–µ–ø–æ–¥–∞–≤–∞—Ç–µ–ª—å</span>
                    {% else %}
                        <span class="badge bg-info">–£—á–µ–Ω–∏–∫</span>
                    {% endif %}
                </div>

                {% if user.is_student and class_info %}
                    <div class="mb-3">
                        <strong>–ö–ª–∞—Å—Å:</strong> {{ class_info.name }}
                    </div>
                {% endif %}

                <div class="mb-3">
                    <strong>–î–∞—Ç–∞ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏:</strong> {{ user.date_joined|date:"d.m.Y" }}
                </div>

                <div class="mb-3">
                    <strong>–ü–æ—Å–ª–µ–¥–Ω–∏–π –≤—Ö–æ–¥:</strong> {{ user.last_login|date:"d.m.Y H:i" }}
                </div>
            </div>
        </div>
    </div>

    <div class="col-md-8">
        {% if user.is_student %}
            <!-- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ —É—á–µ–Ω–∏–∫–∞ -->
            <div class="card mb-4">
                <div class="card-header">
                    <h5>üìä –¢–≤–æ—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞</h5>
                </div>
                <div class="card-body">
                    <div class="row text-center">
                        <div class="col-md-4">
                            <h3 class="text-primary">{{ progress_count }}</h3>
                            <p>–ó–∞–¥–∞–Ω–∏–π –≤—ã–ø–æ–ª–Ω–µ–Ω–æ</p>
                        </div>
                        <div class="col-md-4">
                            <h3 class="text-success">
                                {% if progress_count %}
                                    {% load mathfilters %}
                                    85%  {# –ü—Ä–∏–º–µ—Ä —Å—Ä–µ–¥–Ω–µ–≥–æ –±–∞–ª–ª–∞ #}
                                {% else %}
                                    0%
                                {% endif %}
                            </h3>
                            <p>–°—Ä–µ–¥–Ω–∏–π –±–∞–ª–ª</p>
                        </div>
                        <div class="col-md-4">
                            <h3 class="text-info">1</h3>
                            <p>–£—Ä–æ–≤–µ–Ω—å</p>
                        </div>
                    </div>
                </div>
            </div>
        {% elif user.is_admin %}
            <!-- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞ -->
            <div class="card mb-4">
                <div class="card-header">
                    <h5>‚öôÔ∏è –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω–∏—è</h5>
                </div>
                <div class="card-body">
                    <div class="row text-center">
                        <div class="col-md-4">
                            <h3 class="text-primary">{{ managed_classes|length }}</h3>
                            <p>–£–ø—Ä–∞–≤–ª—è–µ–º—ã—Ö –∫–ª–∞—Å—Å–æ–≤</p>
                        </div>
                        <div class="col-md-4">
                            <h3 class="text-success">{{ total_students }}</h3>
                            <p>–£—á–µ–Ω–∏–∫–æ–≤</p>
                        </div>
                        <div class="col-md-4">
                            <h3 class="text-info">1</h3>
                            <p>–ê–∫—Ç–∏–≤–Ω—ã—Ö —Ç–µ–º</p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- –£–ø—Ä–∞–≤–ª—è–µ–º—ã–µ –∫–ª–∞—Å—Å—ã -->
            {% if managed_classes %}
                <div class="card">
                    <div class="card-header">
                        <h5>üë• –£–ø—Ä–∞–≤–ª—è–µ–º—ã–µ –∫–ª–∞—Å—Å—ã</h5>
                    </div>
                    <div class="card-body">
                        <div class="row">
                            {% for class_obj in managed_classes %}
                                <div class="col-md-6 mb-3">
                                    <div class="card">
                                        <div class="card-body">
                                            <h6>{{ class_obj.name }}</h6>
                                            <p class="text-muted">{{ class_obj.description }}</p>
                                            <div class="d-flex justify-content-between align-items-center">
                                                <small>{{ class_obj.students.count }} —É—á–µ–Ω–∏–∫–æ–≤</small>
                                                <a href="{% url 'courses:class_detail' class_obj.pk %}" class="btn btn-sm btn-outline-primary">
                                                    –£–ø—Ä–∞–≤–ª—è—Ç—å
                                                </a>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            {% endfor %}
                        </div>
                    </div>
                </div>
            {% endif %}
        {% endif %}
    </div>
</div>
{% endblock %}
