# Шаг 2: Исправление багов

## Что мы делаем на этом шаге

В шаге 1 мы привели в порядок модуль `enemy.py`.  
Теперь исправляем **три бага** в классе `Projectile` (снаряд) и одну опечатку.

---

## Баг 1: `self.velocity = 0` вместо `Vector2(0, 0)`

### Где находится

Файл `game.py`, класс `Projectile`, два места:
- Метод `__init__` — когда игрок кликнул точно на себя (направление = 0)
- Метод `reset()` — когда снаряд деактивируется

### В чём проблема

```python
# Было:
self.velocity = 0
```

Здесь `0` — это обычное **число** (тип `int`).  
Но в методе `update()` мы обращаемся к `self.velocity.x` и `self.velocity.y`.  
У числа `0` нет свойств `.x` и `.y` — Python выдаст ошибку:

```
AttributeError: 'int' object has no attribute 'x'
```

### Как исправили

```python
# Стало:
self.velocity = pygame.math.Vector2(0, 0)
```

`Vector2(0, 0)` — это вектор нулевой длины. У него есть `.x` (= 0) и `.y` (= 0).

### Что объяснить ученикам

> **Типы данных важны!**  
> `0` и `Vector2(0, 0)` — оба означают "ничего", но это разные типы.  
> Число `0` не умеет делать то, что умеет вектор.  
> Это как написать "ноль" карандашом или на калькуляторе — значение одно, а возможности разные.

---

## Баг 2: Перевёрнутая логика трения

### Где находится

Файл `game.py`, класс `Projectile`, метод `update()` — фаза падения после рикошета.

### В чём проблема

```python
# Было:
if abs(self.velocity.x) < 0.1:       # если скорость МАЛЕНЬКАЯ
    self.velocity.x = self.velocity.x * 0.92  # замедляем  ← зачем?
else:                                  # если скорость БОЛЬШАЯ
    self.velocity.x = 0                # полная остановка  ← ???
```

Логика перевёрнута:
- Когда скорость **маленькая** (< 0.1) — код пытается её замедлить. Но она и так почти ноль!
- Когда скорость **большая** — код резко обнуляет её. Снаряд мгновенно останавливается!

**Результат:** снаряд после рикошета сразу "замерзает" в воздухе вместо плавного замедления.

### Как исправили

```python
# Стало:
if abs(self.velocity.x) > 0.1:       # если скорость ещё заметная
    self.velocity.x *= 0.92           # плавно замедляем (трение)
else:                                  # если скорость почти нулевая
    self.velocity.x = 0               # полная остановка
```

Теперь:
1. Снаряд рикошетит от стены
2. Каждый кадр горизонтальная скорость уменьшается на 8% (трение)
3. Когда скорость становится крошечной (< 0.1) — обнуляем, чтобы не дёргался

### Что объяснить ученикам

> **Условие `if` надо читать вслух!**  
> "Если скорость больше 0.1 — замедляй. Иначе — останови."  
> Если смысл звучит странно — значит условие перевёрнуто.  
> Всегда проверяй: что будет, если число большое? А если маленькое?

---

## Баг 3: Опечатка `PICUP_DISTANCE`

### Где находится

Файл `game.py`, константа и метод `is_close_to_player()`.

### В чём проблема

```python
# Было:
PICUP_DISTANCE = 40          # пропущена буква K
picup_zone = player_rect.inflate(PICUP_DISTANCE, PICUP_DISTANCE)
```

### Как исправили

```python
# Стало:
PICKUP_DISTANCE = 40          # правильное написание
pickup_zone = player_rect.inflate(PICKUP_DISTANCE, PICKUP_DISTANCE)
```

### Что объяснить ученикам

> **Имена переменных — это документация!**  
> Другой программист (или ты через неделю) прочитает `PICUP` и не поймёт.  
> `PICKUP` — сразу понятно: "расстояние подбора".  
> Называй переменные так, чтобы код читался как текст.

---

## Дополнительно: комментарии

Весь код в `game.py` и `enemy.py` теперь прокомментирован:
- **Каждый класс** имеет описание (docstring)
- **Каждый метод** объясняет что делает
- **Ключевые строки** имеют комментарии с пояснением логики
- **Секции кода** разделены заголовками (`# --- Обработка событий ---`)
- **Физика** объяснена: гравитация, рикошет, трение, нормализация вектора

Это важно для обучения — ученики должны видеть, зачем нужна каждая строка.

---

## Итог изменений

| Что | Было | Стало |
|-----|------|-------|
| `velocity` при нуле | `= 0` (int) | `= Vector2(0, 0)` |
| `velocity` при reset | `= 0` (int) | `= Vector2(0, 0)` |
| Трение (условие) | `< 0.1` → замедлять | `> 0.1` → замедлять |
| Константа подбора | `PICUP_DISTANCE` | `PICKUP_DISTANCE` |
| Комментарии | Минимум | Полные, на русском |

---

## Файлы в этом шаге

```
step_2_fix_bugs/
├── enemy.py     — без изменений логики, добавлены комментарии
├── game.py      — 3 бага исправлены + полные комментарии
└── changes.md   — этот файл
```

## Следующий шаг

**Шаг 3** — Система жизней: 3 HP, отбрасывание при ударе, отображение на экране.
